import xmlrpclib
import time

from multiprocessing import Pool
from socket import error as socket_error

DEEPBLUE_URL = "http://deepblue.mpi-inf.mpg.de/xmlrpc"
USER_KEY = 'anonymous_key'

MAX_REQUEST_SIMULTANEOUS = 16

def request_data(request_id):
    (status, info) = SERVER.info(request_id, USER_KEY)
    request_status = info[0]["state"]

    while request_status != "done" and request_status != "failed":
        print info
        time.sleep(10)
        (status, info) = SERVER.info(request_id, USER_KEY)
        request_status = info[0]["state"]

    (status, data) = SERVER.get_request_data(request_id, USER_KEY)
    if status != "okay":
        print data
        return None

    return data


def get_chromatin_stes(genome, user_key):

    status, csss_query_id = SERVER.select_regions(
        None, genome, "Chromatin State Segmentation",
        None, None, None, None, None, None, user_key)
    print status, csss_query_id

    status, csss_names_request_id = SERVER.distinct_column_values(
        csss_query_id, "NAME", user_key)
    print csss_names_request_id
    distinct_values = request_data(csss_names_request_id)
    print distinct_values['distinct']

    return distinct_values['distinct']


def q(data):
    server_worker = xmlrpclib.Server(DEEPBLUE_URL, allow_none=True)

    [css_file, states] = data
    result = []

    while True:
        try:
            _, css_file_query_id = server_worker.select_experiments(
                css_file, None, None, None, USER_KEY)
            _, css_file_query_cache_id = server_worker.query_cache(
                css_file_query_id, True, USER_KEY)
            for state in states:
                _, css_file_filter_query_id = server_worker.filter_regions(
                    css_file_query_cache_id, "NAME", "==", state, "string", USER_KEY)
                result.append(css_file_filter_query_id)
                print css_file, css_file_filter_query_id

            return css_file, result
        except socket_error as serr:
            print serr



def build_chromatin_state_files(server, user_key):

    _, css_files_list = server.list_experiments(
        "GRCh38", "peaks", "Chromatin State Segmentation", None, None, None, None, user_key)
    _, css_files_names = server.extract_names(css_files_list)
    states = get_chromatin_stes('GRCh38', user_key)

    css_files = []
    for css_file in css_files_names:
        css_files.append([css_file, states])

    pool = Pool(MAX_REQUEST_SIMULTANEOUS)
    results = pool.map(q, css_files)
    pool.close()
    pool.join()
    print results

    return results

####
SERVER = xmlrpclib.Server(DEEPBLUE_URL, allow_none=True)
print SERVER.echo(USER_KEY)

# Query data
# Select the hypo methilated regions where the AVG methyl level is lower
# than 0.0025
_, QUERY_ID = SERVER.select_experiments(
    "S00VEQA1.hypo_meth.bs_call.GRCh38.20150707.bed", None, None, None, USER_KEY)
_, QUERY_ID = SERVER.filter_regions(
    QUERY_ID, "AVG_METHYL_LEVEL", "<", "0.0025", "number", USER_KEY)
print QUERY_ID

# Universe will be tiling regions of 1000bp
_, UNIVERSE_QUERY_ID = SERVER.tiling_regions(1000, "grch38", None, USER_KEY)


# Datasets will be the chromatin segmentation files divided by segments
DATASETS = build_chromatin_state_files(SERVER, USER_KEY)

## Uncomment to use these datasets
# DATASETS = {'S017E3H1_12_12_Blueprint_release_201608_segments.bed': ['q979874', 'q979875', 'q979876', 'q979877', 'q979878', 'q979879', 'q979880', 'q979881', 'q979882', 'q979883', 'q979884', 'q979885'], 'C005PSH2_12_12_Blueprint_release_201608_segments.bed': ['q979594', 'q979595', 'q979596', 'q979597', 'q979598', 'q979599', 'q979600', 'q979601', 'q979602', 'q979603', 'q979604', 'q979605'], 'S00Y4YH1_12_12_Blueprint_release_201608_segments.bed': ['q980392', 'q980393', 'q980394', 'q980395', 'q980396', 'q980397', 'q980398', 'q980399', 'q980400', 'q980401', 'q980402', 'q980403'], 'S00B2JH1_12_12_Blueprint_release_201608_segments.bed': ['q980364', 'q980365', 'q980366', 'q980367', 'q980368', 'q980369', 'q980370', 'q980371', 'q980372', 'q980373', 'q980374', 'q980375'], 'C001UYH1_12_12_Blueprint_release_201608_segments.bed': ['q979468', 'q979469', 'q979470', 'q979471', 'q979472', 'q979473', 'q979474', 'q979475', 'q979476', 'q979477', 'q979478', 'q979479'], 'S005EJH1_12_12_Blueprint_release_201608_segments.bed': ['q980266', 'q980267', 'q980268', 'q980269', 'q980270', 'q980271', 'q980272', 'q980273', 'q980274', 'q980275', 'q980276', 'q980277'], 'S0050AH1_12_12_Blueprint_release_201608_segments.bed': ['q979846', 'q979847', 'q979848', 'q979849', 'q979850', 'q979851', 'q979852', 'q979853', 'q979854', 'q979855', 'q979856', 'q979857'], 'S00G11H1_12_12_Blueprint_release_201608_segments.bed': ['q979090', 'q979091', 'q979092', 'q979093', 'q979094', 'q979095', 'q979096', 'q979097', 'q979098', 'q979099', 'q979100', 'q979101'], 'C003UQH1_12_12_Blueprint_release_201608_segments.bed': ['q979776', 'q979777', 'q979778', 'q979779', 'q979780', 'q979781', 'q979782', 'q979783', 'q979784', 'q979785', 'q979786', 'q979787'], 'C00280H1_12_12_Blueprint_release_201608_segments.bed': ['q979818', 'q979819', 'q979820', 'q979821', 'q979822', 'q979823', 'q979824', 'q979825', 'q979826', 'q979827', 'q979828', 'q979829'], 'S00CYPH1_12_12_Blueprint_release_201608_segments.bed': ['q980014', 'q980015', 'q980016', 'q980017', 'q980018', 'q980019', 'q980020', 'q980021', 'q980022', 'q980023', 'q980024', 'q980025'], 'S00D55H1_12_12_Blueprint_release_201608_segments.bed': ['q980084', 'q980085', 'q980086', 'q980087', 'q980088', 'q980089', 'q980090', 'q980091', 'q980092', 'q980093', 'q980094', 'q980095'], 'S00TU2H1_12_12_Blueprint_release_201608_segments.bed': ['q978544', 'q978545', 'q978546', 'q978547', 'q978548', 'q978549', 'q978550', 'q978551', 'q978552', 'q978553', 'q978554', 'q978555'], 'S00FXFH1_12_12_Blueprint_release_201608_segments.bed': ['q978474', 'q978475', 'q978476', 'q978477', 'q978478', 'q978479', 'q978480', 'q978481', 'q978482', 'q978483', 'q978484', 'q978485'], 'S01FW9H2_12_12_Blueprint_release_201608_segments.bed': ['q978894', 'q978895', 'q978896', 'q978897', 'q978898', 'q978899', 'q978900', 'q978901', 'q978902', 'q978903', 'q978904', 'q978905'], 'S00B0NH1_12_12_Blueprint_release_201608_segments.bed': ['q979902', 'q979903', 'q979904', 'q979905', 'q979906', 'q979907', 'q979908', 'q979909', 'q979910', 'q979911', 'q979912', 'q979913'], 'S004KBH1_12_12_Blueprint_release_201608_segments.bed': ['q979412', 'q979413', 'q979414', 'q979415', 'q979416', 'q979417', 'q979418', 'q979419', 'q979420', 'q979421', 'q979422', 'q979423'], 'S00390H1_12_12_Blueprint_release_201608_segments.bed': ['q979510', 'q979511', 'q979512', 'q979513', 'q979514', 'q979515', 'q979516', 'q979517', 'q979518', 'q979519', 'q979520', 'q979521'], 'S01F8KH2_12_12_Blueprint_release_201608_segments.bed': ['q978852', 'q978853', 'q978854', 'q978855', 'q978856', 'q978857', 'q978858', 'q978859', 'q978860', 'q978861', 'q978862', 'q978863'], 'S00Y21H1_12_12_Blueprint_release_201608_segments.bed': ['q980182', 'q980183', 'q980184', 'q980185', 'q980186', 'q980187', 'q980188', 'q980189', 'q980190', 'q980191', 'q980192', 'q980193'], 'S013RUH1_12_12_Blueprint_release_201608_segments.bed': ['q979972', 'q979973', 'q979974', 'q979975', 'q979976', 'q979977', 'q979978', 'q979979', 'q979980', 'q979981', 'q979982', 'q979983'], 'S006XEH2_12_12_Blueprint_release_201608_segments.bed': ['q978908', 'q978909', 'q978910', 'q978911', 'q978912', 'q978913', 'q978914', 'q978915', 'q978916', 'q978917', 'q978918', 'q978919'], 'S013PYH1_12_12_Blueprint_release_201608_segments.bed': ['q980028', 'q980029', 'q980030', 'q980031', 'q980032', 'q980033', 'q980034', 'q980035', 'q980036', 'q980037', 'q980038', 'q980039'], 'S00Y8QH1_12_12_Blueprint_release_201608_segments.bed': ['q979580', 'q979581', 'q979582', 'q979583', 'q979584', 'q979585', 'q979586', 'q979587', 'q979588', 'q979589', 'q979590', 'q979591'], 'S00XAQH1_12_12_Blueprint_release_201608_segments.bed': ['q978586', 'q978587', 'q978588', 'q978589', 'q978590', 'q978591', 'q978592', 'q978593', 'q978594', 'q978595', 'q978596', 'q978597'], 'C12012H1_12_12_Blueprint_release_201608_segments.bed': ['q978796', 'q978797', 'q978798', 'q978799', 'q978800', 'q978801', 'q978802', 'q978803', 'q978804', 'q978805', 'q978806', 'q978807'], 'S007SKH1_12_12_Blueprint_release_201608_segments.bed': ['q979426', 'q979427', 'q979428', 'q979429', 'q979430', 'q979431', 'q979432', 'q979433', 'q979434', 'q979435', 'q979436', 'q979437'], 'S016MSH1_12_12_Blueprint_release_201608_segments.bed': ['q980238', 'q980239', 'q980240', 'q980241', 'q980242', 'q980243', 'q980244', 'q980245', 'q980246', 'q980247', 'q980248', 'q980249'], 'Z-138_c01_12_12_Blueprint_release_201608_segments.bed': ['q980812', 'q980813', 'q980814', 'q980815', 'q980816', 'q980817', 'q980818', 'q980819', 'q980820', 'q980821', 'q980822', 'q980823'], 'S00XYFH1_12_12_Blueprint_release_201608_segments.bed': ['q980868', 'q980869', 'q980870', 'q980871', 'q980872', 'q980873', 'q980874', 'q980875', 'q980876', 'q980877', 'q980878', 'q980879'], 'S015DDH1_12_12_Blueprint_release_201608_segments.bed': ['q979496', 'q979497', 'q979498', 'q979499', 'q979500', 'q979501', 'q979502', 'q979503', 'q979504', 'q979505', 'q979506', 'q979507'], 'S00TYVH1_12_12_Blueprint_release_201608_segments.bed': ['q979132', 'q979133', 'q979134', 'q979135', 'q979136', 'q979137', 'q979138', 'q979139', 'q979140', 'q979141', 'q979142', 'q979143'], 'S00D2BH1_12_12_Blueprint_release_201608_segments.bed': ['q980378', 'q980379', 'q980380', 'q980381', 'q980382', 'q980383', 'q980384', 'q980385', 'q980386', 'q980387', 'q980388', 'q980389'], 'C002TWH1_12_12_Blueprint_release_201608_segments.bed': ['q979356', 'q979357', 'q979358', 'q979359', 'q979360', 'q979361', 'q979362', 'q979363', 'q979364', 'q979365', 'q979366', 'q979367'], 'S004YKH1_12_12_Blueprint_release_201608_segments.bed': ['q980350', 'q980351', 'q980352', 'q980353', 'q980354', 'q980355', 'q980356', 'q980357', 'q980358', 'q980359', 'q980360', 'q980361'], 'S01GMPH1_12_12_Blueprint_release_201608_segments.bed': ['q979538', 'q979539', 'q979540', 'q979541', 'q979542', 'q979543', 'q979544', 'q979545', 'q979546', 'q979547', 'q979548', 'q979549'], 'S00BKKH1_12_12_Blueprint_release_201608_segments.bed': ['q979020', 'q979021', 'q979022', 'q979023', 'q979024', 'q979025', 'q979026', 'q979027', 'q979028', 'q979029', 'q979030', 'q979031'], 'S00FYDH1_12_12_Blueprint_release_201608_segments.bed': ['q979552', 'q979553', 'q979554', 'q979555', 'q979556', 'q979557', 'q979558', 'q979559', 'q979560', 'q979561', 'q979562', 'q979563'], 'S00Q7NH1_12_12_Blueprint_release_201608_segments.bed': ['q980294', 'q980295', 'q980296', 'q980297', 'q980298', 'q980299', 'q980300', 'q980301', 'q980302', 'q980303', 'q980304', 'q980305'], 'C005QQH1_12_12_Blueprint_release_201608_segments.bed': ['q979860', 'q979861', 'q979862', 'q979863', 'q979864', 'q979865', 'q979866', 'q979867', 'q979868', 'q979869', 'q979870', 'q979871'], 'S01E4WH0_12_12_Blueprint_release_201608_segments.bed': ['q979034', 'q979035', 'q979036', 'q979037', 'q979038', 'q979039', 'q979040', 'q979041', 'q979042', 'q979043', 'q979044', 'q979045'], 'S00GPRH1_12_12_Blueprint_release_201608_segments.bed': ['q980462', 'q980463', 'q980464', 'q980465', 'q980466', 'q980467', 'q980468', 'q980469', 'q980470', 'q980471', 'q980472', 'q980473'], 'S00CWTH1_12_12_Blueprint_release_201608_segments.bed': ['q980728', 'q980729', 'q980730', 'q980731', 'q980732', 'q980733', 'q980734', 'q980735', 'q980736', 'q980737', 'q980738', 'q980739'], 'S0022IH2_12_12_Blueprint_release_201608_segments.bed': ['q979160', 'q979161', 'q979162', 'q979163', 'q979164', 'q979165', 'q979166', 'q979167', 'q979168', 'q979169', 'q979170', 'q979171'], 'S00W8YH2_12_12_Blueprint_release_201608_segments.bed': ['q978922', 'q978923', 'q978924', 'q978925', 'q978926', 'q978927', 'q978928', 'q978929', 'q978930', 'q978931', 'q978932', 'q978933'], 'S00W0DH1_12_12_Blueprint_release_201608_segments.bed': ['q979048', 'q979049', 'q979050', 'q979051', 'q979052', 'q979053', 'q979054', 'q979055', 'q979056', 'q979057', 'q979058', 'q979059'], 'C0010KH2_12_12_Blueprint_release_201608_segments.bed': ['q978838', 'q978839', 'q978840', 'q978841', 'q978842', 'q978843', 'q978844', 'q978845', 'q978846', 'q978847', 'q978848', 'q978849'], 'S00Y05H1_12_12_Blueprint_release_201608_segments.bed': ['q980308', 'q980309', 'q980310', 'q980311', 'q980312', 'q980313', 'q980314', 'q980315', 'q980316', 'q980317', 'q980318', 'q980319'], 'S00D0FH1_12_12_Blueprint_release_201608_segments.bed': ['q980532', 'q980533', 'q980534', 'q980535', 'q980536', 'q980537', 'q980538', 'q980539', 'q980540', 'q980541', 'q980542', 'q980543'], 'S00D47H1_12_12_Blueprint_release_201608_segments.bed': ['q980112', 'q980113', 'q980114', 'q980115', 'q980116', 'q980117', 'q980118', 'q980119', 'q980120', 'q980121', 'q980122', 'q980123'], 'S00K7AH1_12_12_Blueprint_release_201608_segments.bed': ['q979622', 'q979623', 'q979624', 'q979625', 'q979626', 'q979627', 'q979628', 'q979629', 'q979630', 'q979631', 'q979632', 'q979633'], 'S0145XH1_12_12_Blueprint_release_201608_segments.bed': ['q980168', 'q980169', 'q980170', 'q980171', 'q980172', 'q980173', 'q980174', 'q980175', 'q980176', 'q980177', 'q980178', 'q980179'], 'S00AYXH1_12_12_Blueprint_release_201608_segments.bed': ['q980224', 'q980225', 'q980226', 'q980227', 'q980228', 'q980229', 'q980230', 'q980231', 'q980232', 'q980233', 'q980234', 'q980235'], 'S01FKXH1_12_12_Blueprint_release_201608_segments.bed': ['q980616', 'q980617', 'q980618', 'q980619', 'q980620', 'q980621', 'q980622', 'q980623', 'q980624', 'q980625', 'q980626', 'q980627'], 'S002S3H1_12_12_Blueprint_release_201608_segments.bed': ['q978936', 'q978937', 'q978938', 'q978939', 'q978940', 'q978941', 'q978942', 'q978943', 'q978944', 'q978945', 'q978946', 'q978947'], 'S013QWH1_12_12_Blueprint_release_201608_segments.bed': ['q979888', 'q979889', 'q979890', 'q979891', 'q979892', 'q979893', 'q979894', 'q979895', 'q979896', 'q979897', 'q979898', 'q979899'], 'S015BHH1_12_12_Blueprint_release_201608_segments.bed': ['q979272', 'q979273', 'q979274', 'q979275', 'q979276', 'q979277', 'q979278', 'q979279', 'q979280', 'q979281', 'q979282', 'q979283'], 'JVM-2_c01_12_12_Blueprint_release_201608_segments.bed': ['q980784', 'q980785', 'q980786', 'q980787', 'q980788', 'q980789', 'q980790', 'q980791', 'q980792', 'q980793', 'q980794', 'q980795'], 'S00H6OH2_12_12_Blueprint_release_201608_segments.bed': ['q978726', 'q978727', 'q978728', 'q978729', 'q978730', 'q978731', 'q978732', 'q978733', 'q978734', 'q978735', 'q978736', 'q978737'], 'S00D1DH1_12_12_Blueprint_release_201608_segments.bed': ['q980098', 'q980099', 'q980100', 'q980101', 'q980102', 'q980103', 'q980104', 'q980105', 'q980106', 'q980107', 'q980108', 'q980109'], 'S01FH2H1_12_12_Blueprint_release_201608_segments.bed': ['q980140', 'q980141', 'q980142', 'q980143', 'q980144', 'q980145', 'q980146', 'q980147', 'q980148', 'q980149', 'q980150', 'q980151'], 'SU-DHL-5_c01_12_12_Blueprint_release_201608_segments.bed': ['q980840', 'q980841', 'q980842', 'q980843', 'q980844', 'q980845', 'q980846', 'q980847', 'q980848', 'q980849', 'q980850', 'q980851'], 'S00VEQH1_12_12_Blueprint_release_201608_segments.bed': ['q978460', 'q978461', 'q978462', 'q978463', 'q978464', 'q978465', 'q978466', 'q978467', 'q978468', 'q978469', 'q978470', 'q978471'], 'S01FJZH1_12_12_Blueprint_release_201608_segments.bed': ['q980336', 'q980337', 'q980338', 'q980339', 'q980340', 'q980341', 'q980342', 'q980343', 'q980344', 'q980345', 'q980346', 'q980347'], 'S00XCMH1_12_12_Blueprint_release_201608_segments.bed': ['q980210', 'q980211', 'q980212', 'q980213', 'q980214', 'q980215', 'q980216', 'q980217', 'q980218', 'q980219', 'q980220', 'q980221'], 'S00XEIH1_12_12_Blueprint_release_201608_segments.bed': ['q980560', 'q980561', 'q980562', 'q980563', 'q980564', 'q980565', 'q980566', 'q980567', 'q980568', 'q980569', 'q980570', 'q980571'], 'C004GDH1_12_12_Blueprint_release_201608_segments.bed': ['q979454', 'q979455', 'q979456', 'q979457', 'q979458', 'q979459', 'q979460', 'q979461', 'q979462', 'q979463', 'q979464', 'q979465'], 'S00622H1_12_12_Blueprint_release_201608_segments.bed': ['q979006', 'q979007', 'q979008', 'q979009', 'q979010', 'q979011', 'q979012', 'q979013', 'q979014', 'q979015', 'q979016', 'q979017'], 'S00JHVH1_12_12_Blueprint_release_201608_segments.bed': ['q979524', 'q979525', 'q979526', 'q979527', 'q979528', 'q979529', 'q979530', 'q979531', 'q979532', 'q979533', 'q979534', 'q979535'], 'S01GW5H1_12_12_Blueprint_release_201608_segments.bed': ['q980644', 'q980645', 'q980646', 'q980647', 'q980648', 'q980649', 'q980650', 'q980651', 'q980652', 'q980653', 'q980654', 'q980655'], 'S013SSH1_12_12_Blueprint_release_201608_segments.bed': ['q980154', 'q980155', 'q980156', 'q980157', 'q980158', 'q980159', 'q980160', 'q980161', 'q980162', 'q980163', 'q980164', 'q980165'], 'S001S7H2_12_12_Blueprint_release_201608_segments.bed': ['q978516', 'q978517', 'q978518', 'q978519', 'q978520', 'q978521', 'q978522', 'q978523', 'q978524', 'q978525', 'q978526', 'q978527'], 'S008H1H1_12_12_Blueprint_release_201608_segments.bed': ['q978950', 'q978951', 'q978952', 'q978953', 'q978954', 'q978955', 'q978956', 'q978957', 'q978958', 'q978959', 'q978960', 'q978961'], 'C000S5H2_12_12_Blueprint_release_201608_segments.bed': ['q978530', 'q978531', 'q978532', 'q978533', 'q978534', 'q978535', 'q978536', 'q978537', 'q978538', 'q978539', 'q978540', 'q978541'], 'C002Q1H1_12_12_Blueprint_release_201608_segments.bed': ['q979748', 'q979749', 'q979750', 'q979751', 'q979752', 'q979753', 'q979754', 'q979755', 'q979756', 'q979757', 'q979758', 'q979759'], 'S01PV8H1_12_12_Blueprint_release_201608_segments.bed': ['q980448', 'q980449', 'q980450', 'q980451', 'q980452', 'q980453', 'q980454', 'q980455', 'q980456', 'q980457', 'q980458', 'q980459'], 'S005DLH1_12_12_Blueprint_release_201608_segments.bed': ['q980714', 'q980715', 'q980716', 'q980717', 'q980718', 'q980719', 'q980720', 'q980721', 'q980722', 'q980723', 'q980724', 'q980725'], 'BL-2_c01_12_12_Blueprint_release_201608_segments.bed': ['q980742', 'q980743', 'q980744', 'q980745', 'q980746', 'q980747', 'q980748', 'q980749', 'q980750', 'q980751', 'q980752', 'q980753'], 'S013M3H1_12_12_Blueprint_release_201608_segments.bed': ['q980546', 'q980547', 'q980548', 'q980549', 'q980550', 'q980551', 'q980552', 'q980553', 'q980554', 'q980555', 'q980556', 'q980557'], 'S00JGXH1_12_12_Blueprint_release_201608_segments.bed': ['q978488', 'q978489', 'q978490', 'q978491', 'q978492', 'q978493', 'q978494', 'q978495', 'q978496', 'q978497', 'q978498', 'q978499'], 'S009W4H1_12_12_Blueprint_release_201608_segments.bed': ['q979188', 'q979189', 'q979190', 'q979191', 'q979192', 'q979193', 'q979194', 'q979195', 'q979196', 'q979197', 'q979198', 'q979199'], 'S00JE0H1_12_12_Blueprint_release_201608_segments.bed': ['q978684', 'q978685', 'q978686', 'q978687', 'q978688', 'q978689', 'q978690', 'q978691', 'q978692', 'q978693', 'q978694', 'q978695'], 'S015CFH1_12_12_Blueprint_release_201608_segments.bed': ['q979146', 'q979147', 'q979148', 'q979149', 'q979150', 'q979151', 'q979152', 'q979153', 'q979154', 'q979155', 'q979156', 'q979157'], 'S00XVLH1_12_12_Blueprint_release_201608_segments.bed': ['q980252', 'q980253', 'q980254', 'q980255', 'q980256', 'q980257', 'q980258', 'q980259', 'q980260', 'q980261', 'q980262', 'q980263'], 'S00XDKH1_12_12_Blueprint_release_201608_segments.bed': ['q980588', 'q980589', 'q980590', 'q980591', 'q980592', 'q980593', 'q980594', 'q980595', 'q980596', 'q980597', 'q980598', 'q980599'], 'S007DDH2_12_12_Blueprint_release_201608_segments.bed': ['q979734', 'q979735', 'q979736', 'q979737', 'q979738', 'q979739', 'q979740', 'q979741', 'q979742', 'q979743', 'q979744', 'q979745'], 'S00YAMH1_12_12_Blueprint_release_201608_segments.bed': ['q978670', 'q978671', 'q978672', 'q978673', 'q978674', 'q978675', 'q978676', 'q978677', 'q978678', 'q978679', 'q978680', 'q978681'], 'S0159LH1_12_12_Blueprint_release_201608_segments.bed': ['q979636', 'q979637', 'q979638', 'q979639', 'q979640', 'q979641', 'q979642', 'q979643', 'q979644', 'q979645', 'q979646', 'q979647'], 'S00G03H1_12_12_Blueprint_release_201608_segments.bed': ['q979664', 'q979665', 'q979666', 'q979667', 'q979668', 'q979669', 'q979670', 'q979671', 'q979672', 'q979673', 'q979674', 'q979675'], 'S00VKEH1_12_12_Blueprint_release_201608_segments.bed': ['q979692', 'q979693', 'q979694', 'q979695', 'q979696', 'q979697', 'q979698', 'q979699', 'q979700', 'q979701', 'q979702', 'q979703'], 'C00264H1_12_12_Blueprint_release_201608_segments.bed': ['q979062', 'q979063', 'q979064', 'q979065', 'q979066', 'q979067', 'q979068', 'q979069', 'q979070', 'q979071', 'q979072', 'q979073'], 'S00Y6UH1_12_12_Blueprint_release_201608_segments.bed': ['q980280', 'q980281', 'q980282', 'q980283', 'q980284', 'q980285', 'q980286', 'q980287', 'q980288', 'q980289', 'q980290', 'q980291'], 'S00D63H1_12_12_Blueprint_release_201608_segments.bed': ['q979944', 'q979945', 'q979946', 'q979947', 'q979948', 'q979949', 'q979950', 'q979951', 'q979952', 'q979953', 'q979954', 'q979955'], 'C0066PH1_12_12_Blueprint_release_201608_segments.bed': ['q979328', 'q979329', 'q979330', 'q979331', 'q979332', 'q979333', 'q979334', 'q979335', 'q979336', 'q979337', 'q979338', 'q979339'], 'S00VHKH1_12_12_Blueprint_release_201608_segments.bed': ['q979482', 'q979483', 'q979484', 'q979485', 'q979486', 'q979487', 'q979488', 'q979489', 'q979490', 'q979491', 'q979492', 'q979493'], 'C00184H2_12_12_Blueprint_release_201608_segments.bed': ['q979384', 'q979385', 'q979386', 'q979387', 'q979388', 'q979389', 'q979390', 'q979391', 'q979392', 'q979393', 'q979394', 'q979395'], 'S001MJH1_12_12_Blueprint_release_201608_segments.bed': ['q978642', 'q978643', 'q978644', 'q978645', 'q978646', 'q978647', 'q978648', 'q978649', 'q978650', 'q978651', 'q978652', 'q978653'], 'S00SB7H1_12_12_Blueprint_release_201608_segments.bed': ['q980686', 'q980687', 'q980688', 'q980689', 'q980690', 'q980691', 'q980692', 'q980693', 'q980694', 'q980695', 'q980696', 'q980697'], 'S00B1LH1_12_12_Blueprint_release_201608_segments.bed': ['q980854', 'q980855', 'q980856', 'q980857', 'q980858', 'q980859', 'q980860', 'q980861', 'q980862', 'q980863', 'q980864', 'q980865'], 'S005YGH1_12_12_Blueprint_release_201608_segments.bed': ['q978656', 'q978657', 'q978658', 'q978659', 'q978660', 'q978661', 'q978662', 'q978663', 'q978664', 'q978665', 'q978666', 'q978667'], 'S000RDH2_12_12_Blueprint_release_201608_segments.bed': ['q978768', 'q978769', 'q978770', 'q978771', 'q978772', 'q978773', 'q978774', 'q978775', 'q978776', 'q978777', 'q978778', 'q978779'], 'S005GFH1_12_12_Blueprint_release_201608_segments.bed': ['q980322', 'q980323', 'q980324', 'q980325', 'q980326', 'q980327', 'q980328', 'q980329', 'q980330', 'q980331', 'q980332', 'q980333'], 'S013GFH1_12_12_Blueprint_release_201608_segments.bed': ['q978600', 'q978601', 'q978602', 'q978603', 'q978604', 'q978605', 'q978606', 'q978607', 'q978608', 'q978609', 'q978610', 'q978611'], 'S00XUNH1_12_12_Blueprint_release_201608_segments.bed': ['q980070', 'q980071', 'q980072', 'q980073', 'q980074', 'q980075', 'q980076', 'q980077', 'q980078', 'q980079', 'q980080', 'q980081'], 'S00C2FH1_12_12_Blueprint_release_201608_segments.bed': ['q979258', 'q979259', 'q979260', 'q979261', 'q979262', 'q979263', 'q979264', 'q979265', 'q979266', 'q979267', 'q979268', 'q979269'], 'S01H0SH1_12_12_Blueprint_release_201608_segments.bed': ['q980042', 'q980043', 'q980044', 'q980045', 'q980046', 'q980047', 'q980048', 'q980049', 'q980050', 'q980051', 'q980052', 'q980053'], 'S0018AH1_12_12_Blueprint_release_201608_segments.bed': ['q979440', 'q979441', 'q979442', 'q979443', 'q979444', 'q979445', 'q979446', 'q979447', 'q979448', 'q979449', 'q979450', 'q979451'], 'S00AXZH1_12_12_Blueprint_release_201608_segments.bed': ['q979916', 'q979917', 'q979918', 'q979919', 'q979920', 'q979921', 'q979922', 'q979923', 'q979924', 'q979925', 'q979926', 'q979927'], 'S013N1H1_12_12_Blueprint_release_201608_segments.bed': ['q980504', 'q980505', 'q980506', 'q980507', 'q980508', 'q980509', 'q980510', 'q980511', 'q980512', 'q980513', 'q980514', 'q980515'], 'S00VDSH1_12_12_Blueprint_release_201608_segments.bed': ['q979118', 'q979119', 'q979120', 'q979121', 'q979122', 'q979123', 'q979124', 'q979125', 'q979126', 'q979127', 'q979128', 'q979129'], 'C005VGH1_12_12_Blueprint_release_201608_segments.bed': ['q979174', 'q979175', 'q979176', 'q979177', 'q979178', 'q979179', 'q979180', 'q979181', 'q979182', 'q979183', 'q979184', 'q979185'], 'S00BS4H1_12_12_Blueprint_release_201608_segments.bed': ['q979720', 'q979721', 'q979722', 'q979723', 'q979724', 'q979725', 'q979726', 'q979727', 'q979728', 'q979729', 'q979730', 'q979731'], 'S00VFOH1_12_12_Blueprint_release_201608_segments.bed': ['q978754', 'q978755', 'q978756', 'q978757', 'q978758', 'q978759', 'q978760', 'q978761', 'q978762', 'q978763', 'q978764', 'q978765'], 'S00X9SH1_12_12_Blueprint_release_201608_segments.bed': ['q979202', 'q979203', 'q979204', 'q979205', 'q979206', 'q979207', 'q979208', 'q979209', 'q979210', 'q979211', 'q979212', 'q979213'], 'S01PTCH1_12_12_Blueprint_release_201608_segments.bed': ['q980434', 'q980435', 'q980436', 'q980437', 'q980438', 'q980439', 'q980440', 'q980441', 'q980442', 'q980443', 'q980444', 'q980445'], 'S00XXHH1_12_12_Blueprint_release_201608_segments.bed': ['q980700', 'q980701', 'q980702', 'q980703', 'q980704', 'q980705', 'q980706', 'q980707', 'q980708', 'q980709', 'q980710', 'q980711'], 'S01FE8H1_12_12_Blueprint_release_201608_segments.bed': ['q979958', 'q979959', 'q979960', 'q979961', 'q979962', 'q979963', 'q979964', 'q979965', 'q979966', 'q979967', 'q979968', 'q979969'], 'S00FGCH1_12_12_Blueprint_release_201608_segments.bed': ['q980672', 'q980673', 'q980674', 'q980675', 'q980676', 'q980677', 'q980678', 'q980679', 'q980680', 'q980681', 'q980682', 'q980683'], 'S00518H1_12_12_Blueprint_release_201608_segments.bed': ['q980056', 'q980057', 'q980058', 'q980059', 'q980060', 'q980061', 'q980062', 'q980063', 'q980064', 'q980065', 'q980066', 'q980067'], 'S00FWHH1_12_12_Blueprint_release_201608_segments.bed': ['q979804', 'q979805', 'q979806', 'q979807', 'q979808', 'q979809', 'q979810', 'q979811', 'q979812', 'q979813', 'q979814', 'q979815'], 'S00XFGH1_12_12_Blueprint_release_201608_segments.bed': ['q980602', 'q980603', 'q980604', 'q980605', 'q980606', 'q980607', 'q980608', 'q980609', 'q980610', 'q980611', 'q980612', 'q980613'], 'S002R5H1_12_12_Blueprint_release_201608_segments.bed': ['q979370', 'q979371', 'q979372', 'q979373', 'q979374', 'q979375', 'q979376', 'q979377', 'q979378', 'q979379', 'q979380', 'q979381'], 'S001S7H1_12_12_Blueprint_release_201608_segments.bed': ['q978558', 'q978559', 'q978560', 'q978561', 'q978562', 'q978563', 'q978564', 'q978565', 'q978566', 'q978567', 'q978568', 'q978569'], 'S01FG4H1_12_12_Blueprint_release_201608_segments.bed': ['q980756', 'q980757', 'q980758', 'q980759', 'q980760', 'q980761', 'q980762', 'q980763', 'q980764', 'q980765', 'q980766', 'q980767'], 'S00VCUH1_12_12_Blueprint_release_201608_segments.bed': ['q978740', 'q978741', 'q978742', 'q978743', 'q978744', 'q978745', 'q978746', 'q978747', 'q978748', 'q978749', 'q978750', 'q978751'], 'S00BHQH1_12_12_Blueprint_release_201608_segments.bed': ['q979314', 'q979315', 'q979316', 'q979317', 'q979318', 'q979319', 'q979320', 'q979321', 'q979322', 'q979323', 'q979324', 'q979325'], 'S00TV0H1_12_12_Blueprint_release_201608_segments.bed': ['q979300', 'q979301', 'q979302', 'q979303', 'q979304', 'q979305', 'q979306', 'q979307', 'q979308', 'q979309', 'q979310', 'q979311'], 'DG-75_c01_12_12_Blueprint_release_201608_segments.bed': ['q980770', 'q980771', 'q980772', 'q980773', 'q980774', 'q980775', 'q980776', 'q980777', 'q980778', 'q980779', 'q980780', 'q980781'], 'S00UJKH1_12_12_Blueprint_release_201608_segments.bed': ['q978614', 'q978615', 'q978616', 'q978617', 'q978618', 'q978619', 'q978620', 'q978621', 'q978622', 'q978623', 'q978624', 'q978625'], 'S00DCSH1_12_12_Blueprint_release_201608_segments.bed': ['q978712', 'q978713', 'q978714', 'q978715', 'q978716', 'q978717', 'q978718', 'q978719', 'q978720', 'q978721', 'q978722', 'q978723'], 'S00C1HH1_12_12_Blueprint_release_201608_segments.bed': ['q979762', 'q979763', 'q979764', 'q979765', 'q979766', 'q979767', 'q979768', 'q979769', 'q979770', 'q979771', 'q979772', 'q979773'], 'S01F8KH1_12_12_Blueprint_release_201608_segments.bed': ['q979286', 'q979287', 'q979288', 'q979289', 'q979290', 'q979291', 'q979292', 'q979293', 'q979294', 'q979295', 'q979296', 'q979297'], 'S005FHH1_12_12_Blueprint_release_201608_segments.bed': ['q980196', 'q980197', 'q980198', 'q980199', 'q980200', 'q980201', 'q980202', 'q980203', 'q980204', 'q980205', 'q980206', 'q980207'], 'S00G3YH1_12_12_Blueprint_release_201608_segments.bed': ['q979650', 'q979651', 'q979652', 'q979653', 'q979654', 'q979655', 'q979656', 'q979657', 'q979658', 'q979659', 'q979660', 'q979661'], 'S00XWJH1_12_12_Blueprint_release_201608_segments.bed': ['q980420', 'q980421', 'q980422', 'q980423', 'q980424', 'q980425', 'q980426', 'q980427', 'q980428', 'q980429', 'q980430', 'q980431'], 'S00T2LH1_12_12_Blueprint_release_201608_segments.bed': ['q978866', 'q978867', 'q978868', 'q978869', 'q978870', 'q978871', 'q978872', 'q978873', 'q978874', 'q978875', 'q978876', 'q978877'], 'S01GX3H1_12_12_Blueprint_release_201608_segments.bed': ['q979930', 'q979931', 'q979932', 'q979933', 'q979934', 'q979935', 'q979936', 'q979937', 'q979938', 'q979939', 'q979940', 'q979941'], 'S007G7H4_12_12_Blueprint_release_201608_segments.bed': ['q978782', 'q978783', 'q978784', 'q978785', 'q978786', 'q978787', 'q978788', 'q978789', 'q978790', 'q978791', 'q978792', 'q978793'], 'S0022IH1_12_12_Blueprint_release_201608_segments.bed': ['q978502', 'q978503', 'q978504', 'q978505', 'q978506', 'q978507', 'q978508', 'q978509', 'q978510', 'q978511', 'q978512', 'q978513'], 'S00YPTH1_12_12_Blueprint_release_201608_segments.bed': ['q979608', 'q979609', 'q979610', 'q979611', 'q979612', 'q979613', 'q979614', 'q979615', 'q979616', 'q979617', 'q979618', 'q979619'], 'S00FTNH1_12_12_Blueprint_release_201608_segments.bed': ['q979076', 'q979077', 'q979078', 'q979079', 'q979080', 'q979081', 'q979082', 'q979083', 'q979084', 'q979085', 'q979086', 'q979087'], 'S00W1BH1_12_12_Blueprint_release_201608_segments.bed': ['q979398', 'q979399', 'q979400', 'q979401', 'q979402', 'q979403', 'q979404', 'q979405', 'q979406', 'q979407', 'q979408', 'q979409'], 'S00BJMH2_12_12_Blueprint_release_201608_segments.bed': ['q978978', 'q978979', 'q978980', 'q978981', 'q978982', 'q978983', 'q978984', 'q978985', 'q978986', 'q978987', 'q978988', 'q978989'], 'C000S5H1_12_12_Blueprint_release_201608_segments.bed': ['q978698', 'q978699', 'q978700', 'q978701', 'q978702', 'q978703', 'q978704', 'q978705', 'q978706', 'q978707', 'q978708', 'q978709'], 'S01H5IH1_12_12_Blueprint_release_201608_segments.bed': ['q979342', 'q979343', 'q979344', 'q979345', 'q979346', 'q979347', 'q979348', 'q979349', 'q979350', 'q979351', 'q979352', 'q979353'], 'S000RDH1_12_12_Blueprint_release_201608_segments.bed': ['q978628', 'q978629', 'q978630', 'q978631', 'q978632', 'q978633', 'q978634', 'q978635', 'q978636', 'q978637', 'q978638', 'q978639'], 'S006VIH1_12_12_Blueprint_release_201608_segments.bed': ['q979790', 'q979791', 'q979792', 'q979793', 'q979794', 'q979795', 'q979796', 'q979797', 'q979798', 'q979799', 'q979800', 'q979801'], 'S01FF6H1_12_12_Blueprint_release_201608_segments.bed': ['q980490', 'q980491', 'q980492', 'q980493', 'q980494', 'q980495', 'q980496', 'q980497', 'q980498', 'q980499', 'q980500', 'q980501'], 'C0011IH2_12_12_Blueprint_release_201608_segments.bed': ['q979678', 'q979679', 'q979680', 'q979681', 'q979682', 'q979683', 'q979684', 'q979685', 'q979686', 'q979687', 'q979688', 'q979689'], 'S00K88H1_12_12_Blueprint_release_201608_segments.bed': ['q978880', 'q978881', 'q978882', 'q978883', 'q978884', 'q978885', 'q978886', 'q978887', 'q978888', 'q978889', 'q978890', 'q978891'], 'S00K6CH1_12_12_Blueprint_release_201608_segments.bed': ['q979230', 'q979231', 'q979232', 'q979233', 'q979234', 'q979235', 'q979236', 'q979237', 'q979238', 'q979239', 'q979240', 'q979241'], 'S014WGH1_12_12_Blueprint_release_201608_segments.bed': ['q978572', 'q978573', 'q978574', 'q978575', 'q978576', 'q978577', 'q978578', 'q978579', 'q978580', 'q978581', 'q978582', 'q978583'], 'S01GKTH1_12_12_Blueprint_release_201608_segments.bed': ['q978992', 'q978993', 'q978994', 'q978995', 'q978996', 'q978997', 'q978998', 'q978999', 'q979000', 'q979001', 'q979002', 'q979003'], 'S004BTH2_12_12_Blueprint_release_201608_segments.bed': ['q979832', 'q979833', 'q979834', 'q979835', 'q979836', 'q979837', 'q979838', 'q979839', 'q979840', 'q979841', 'q979842', 'q979843'], 'S00DVRH1_12_12_Blueprint_release_201608_segments.bed': ['q979244', 'q979245', 'q979246', 'q979247', 'q979248', 'q979249', 'q979250', 'q979251', 'q979252', 'q979253', 'q979254', 'q979255'], 'S00D39H1_12_12_Blueprint_release_201608_segments.bed': ['q980476', 'q980477', 'q980478', 'q980479', 'q980480', 'q980481', 'q980482', 'q980483', 'q980484', 'q980485', 'q980486', 'q980487'], 'C002YMH1_12_12_Blueprint_release_201608_segments.bed': ['q978810', 'q978811', 'q978812', 'q978813', 'q978814', 'q978815', 'q978816', 'q978817', 'q978818', 'q978819', 'q978820', 'q978821'], 'S005CNH1_12_12_Blueprint_release_201608_segments.bed': ['q980574', 'q980575', 'q980576', 'q980577', 'q980578', 'q980579', 'q980580', 'q980581', 'q980582', 'q980583', 'q980584', 'q980585'], 'S00BJMH1_12_12_Blueprint_release_201608_segments.bed': ['q978824', 'q978825', 'q978826', 'q978827', 'q978828', 'q978829', 'q978830', 'q978831', 'q978832', 'q978833', 'q978834', 'q978835'], 'S00CXRH1_12_12_Blueprint_release_201608_segments.bed': ['q980406', 'q980407', 'q980408', 'q980409', 'q980410', 'q980411', 'q980412', 'q980413', 'q980414', 'q980415', 'q980416', 'q980417'], 'KARPAS-422_c01_12_12_Blueprint_release_201608_segments.bed': ['q980798', 'q980799', 'q980800', 'q980801', 'q980802', 'q980803', 'q980804', 'q980805', 'q980806', 'q980807', 'q980808', 'q980809'], 'S00Y9OH1_12_12_Blueprint_release_201608_segments.bed': ['q979216', 'q979217', 'q979218', 'q979219', 'q979220', 'q979221', 'q979222', 'q979223', 'q979224', 'q979225', 'q979226', 'q979227'], 'S00Y5WH1_12_12_Blueprint_release_201608_segments.bed': ['q979986', 'q979987', 'q979988', 'q979989', 'q979990', 'q979991', 'q979992', 'q979993', 'q979994', 'q979995', 'q979996', 'q979997'], 'S00JFZH1_12_12_Blueprint_release_201608_segments.bed': ['q979566', 'q979567', 'q979568', 'q979569', 'q979570', 'q979571', 'q979572', 'q979573', 'q979574', 'q979575', 'q979576', 'q979577'], 'C004SQH1_12_12_Blueprint_release_201608_segments.bed': ['q978964', 'q978965', 'q978966', 'q978967', 'q978968', 'q978969', 'q978970', 'q978971', 'q978972', 'q978973', 'q978974', 'q978975'], 'S01NTKH1_12_12_Blueprint_release_201608_segments.bed': ['q980000', 'q980001', 'q980002', 'q980003', 'q980004', 'q980005', 'q980006', 'q980007', 'q980008', 'q980009', 'q980010', 'q980011'], 'C002TWH2_12_12_Blueprint_release_201608_segments.bed': ['q979104', 'q979105', 'q979106', 'q979107', 'q979108', 'q979109', 'q979110', 'q979111', 'q979112', 'q979113', 'q979114', 'q979115'], 'S00DFMH1_12_12_Blueprint_release_201608_segments.bed': ['q980630', 'q980631', 'q980632', 'q980633', 'q980634', 'q980635', 'q980636', 'q980637', 'q980638', 'q980639', 'q980640', 'q980641'], 'S00K5EH1_12_12_Blueprint_release_201608_segments.bed': ['q979706', 'q979707', 'q979708', 'q979709', 'q979710', 'q979711', 'q979712', 'q979713', 'q979714', 'q979715', 'q979716', 'q979717'], 'S00Y13H1_12_12_Blueprint_release_201608_segments.bed': ['q980518', 'q980519', 'q980520', 'q980521', 'q980522', 'q980523', 'q980524', 'q980525', 'q980526', 'q980527', 'q980528', 'q980529'], 'S00KPBH1_12_12_Blueprint_release_201608_segments.bed': ['q980658', 'q980659', 'q980660', 'q980661', 'q980662', 'q980663', 'q980664', 'q980665', 'q980666', 'q980667', 'q980668', 'q980669'], 'U-266_c01_12_12_Blueprint_release_201608_segments.bed': ['q980826', 'q980827', 'q980828', 'q980829', 'q980830', 'q980831', 'q980832', 'q980833', 'q980834', 'q980835', 'q980836', 'q980837'], 'S016KWH1_12_12_Blueprint_release_201608_segments.bed': ['q980126', 'q980127', 'q980128', 'q980129', 'q980130', 'q980131', 'q980132', 'q980133', 'q980134', 'q980135', 'q980136', 'q980137']}
print "total of " + str(len(DATASETS)) + " datasets"

__, ENRICH_REQUEST = SERVER.enrich_region_overlap(
    QUERY_ID, UNIVERSE_QUERY_ID, DATASETS, "grch38", USER_KEY)
print "Processing enrich_region_overlap: ", ENRICH_REQUEST

ENRICHMENT_RESULT = request_data(ENRICH_REQUEST)

print ENRICHMENT_RESULT
